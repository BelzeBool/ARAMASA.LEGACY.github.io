<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Хроники Клана Арамаса</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- НАСТРОЙКИ ТЕМ (CSS Переменные) --- */
        :root {
            --bg-main: #f9f7f1;
            --bg-card: #ffffff;
            --text-main: #1a1a1a;
            --text-muted: #5a5a5a;
            --accent: #991b1b;
            --border: #e5e5e5;
            --nav-bg: rgba(255, 255, 255, 0.98);
            --drop-cap: #991b1b;
        }

        body.dark-mode {
            --bg-main: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #ff4d4d;
            --border: #333333;
            --nav-bg: rgba(30, 30, 30, 0.98);
            --drop-cap: #ff4d4d;
        }

        /* --- ОСНОВНЫЕ СТИЛИ --- */
        body {
            font-family: 'Merriweather', serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            line-height: 2.2;
            font-size: 20px;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3, .font-oswald { font-family: 'Oswald', sans-serif; text-transform: uppercase; }

        /* --- ВКЛАДКИ --- */
        .tab-section { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-section.active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- КНИГА --- */
        .book-container {
            max-width: 900px;
            margin: 2rem auto 8rem;
            padding: 4rem 5rem;
            background: var(--bg-card);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            min-height: 80vh;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .chapter-content { display: none; }
        .chapter-content.active-chapter { display: block; animation: fadeIn 0.6s ease; }

        /* Типографика */
        .chapter-header { text-align: center; margin-bottom: 4rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border); }
        .chapter-number { font-family: 'Oswald', sans-serif; font-size: 0.9rem; letter-spacing: 0.3em; color: var(--accent); display: block; margin-bottom: 1rem; font-weight: 700; }
        .chapter-title { font-family: 'Lora', serif; font-size: 3rem; font-weight: 700; line-height: 1.1; }
        
        .drop-cap::first-letter { font-family: 'Lora', serif; font-size: 5rem; font-weight: 700; float: left; margin-right: 1rem; margin-top: -0.5rem; line-height: 0.8; color: var(--drop-cap); }
        
        p { margin-bottom: 1.8rem; text-align: justify; }
        p.dialogue { margin-left: 2rem; position: relative; }
        p.dialogue::before { content: '—'; position: absolute; left: -1.5rem; color: var(--accent); font-weight: bold; }
        .thought { font-style: italic; color: var(--text-muted); }

        /* --- НАВИГАЦИЯ --- */
        .nav-link { cursor: pointer; padding-bottom: 4px; border-bottom: 2px solid transparent; transition: all 0.3s; color: var(--text-muted); }
        .nav-link.active-tab { color: var(--accent); border-bottom-color: var(--accent); }
        .nav-link:hover { color: var(--accent); }

        .controls-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--nav-bg); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border); padding: 1.5rem;
            display: flex; justify-content: center; gap: 2rem;
            z-index: 50; box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
        }

        .btn-nav {
            background: var(--bg-card); border: 1px solid var(--border);
            color: var(--text-main); padding: 0.8rem 2rem;
            font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 2px;
            font-size: 0.9rem; cursor: pointer; transition: all 0.2s; border-radius: 2px;
        }
        .btn-nav:hover:not(:disabled) { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-nav:disabled { opacity: 0.5; cursor: not-allowed; }

        .inline-next-btn {
            background-color: transparent; color: var(--accent); border: 2px solid var(--accent);
            padding: 1rem 3rem; font-family: 'Oswald', sans-serif; font-size: 1.1rem;
            letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.3s;
            display: block; margin: 4rem auto 0;
        }
        .inline-next-btn:hover { background-color: var(--accent); color: white; }

        #progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: var(--accent); width: 0%; z-index: 200; transition: width 0.3s; }

        .chapter-select { appearance: none; background: transparent; border: none; font-family: 'Oswald', sans-serif; font-size: 1rem; font-weight: bold; color: var(--text-main); cursor: pointer; text-align: right; padding-right: 1.5rem; }
        .chapter-select option { background-color: var(--bg-card); color: var(--text-main); }
        .chapter-select:focus { outline: none; }

        @media (max-width: 768px) {
            .book-container { padding: 2rem 1.5rem; margin-top: 1rem; }
            .chapter-title { font-size: 2rem; }
            .controls-bar { justify-content: space-between; padding: 1rem; }
            .btn-nav { padding: 0.5rem 1rem; font-size: 0.8rem; }
            .inline-next-btn { width: 100%; }
        }
    </style>
</head>
<body>

    <div id="progress-bar"></div>

    <!-- ШАПКА -->
    <nav class="sticky top-0 z-40 border-b border-[var(--border)] bg-[var(--nav-bg)] backdrop-blur-md transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            
            <div class="text-xl md:text-2xl font-bold tracking-tighter font-oswald cursor-pointer" onclick="switchTab('read'); goToChapter(0)">
                ARAMASA<span style="color: var(--accent)">.SAGA</span>
            </div>

            <div class="flex space-x-4 md:space-x-8">
                <button onclick="switchTab('read')" id="tab-read" class="nav-link active-tab font-oswald text-xs md:text-sm font-bold tracking-widest uppercase">Читать</button>
                <button onclick="switchTab('audio')" id="tab-audio" class="nav-link font-oswald text-xs md:text-sm font-bold tracking-widest uppercase">Аудио</button>
                <button onclick="switchTab('manga')" id="tab-manga" class="nav-link font-oswald text-xs md:text-sm font-bold tracking-widest uppercase">Манга</button>
            </div>

            <div class="flex items-center space-x-4">
                <div class="hidden md:block" id="chapter-selector-container">
                    <select id="chapter-dropdown" class="chapter-select uppercase" onchange="goToChapter(this.value)"></select>
                </div>

                <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-[var(--border)] transition" title="Сменить тему">
                    <svg id="icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg id="icon-moon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-grow">

        <!-- ======================= Вкл 1: ЧИТАТЬ ======================= -->
        <section id="section-read" class="tab-section active-section">
            <div class="book-container">
                <div id="chapters-container">
                    <div class="text-center text-[var(--text-muted)] italic">Загрузка глав...</div>
                </div>
            </div>
            
            <!-- НИЖНЯЯ ПАНЕЛЬ -->
            <div id="controls-read" class="controls-bar">
                <button onclick="prevChapter()" id="btn-prev" class="btn-nav">← Назад</button>
                <div class="flex flex-col text-center">
                    <span id="chapter-indicator" class="font-bold text-sm tracking-widest uppercase" style="color: var(--text-main)">Вступление</span>
                </div>
                <button onclick="nextChapter()" id="btn-next" class="btn-nav">Вперед →</button>
            </div>
        </section>

        <!-- ======================= Вкл 2: АУДИО ======================= -->
        <section id="section-audio" class="tab-section">
            <div class="book-container flex flex-col items-center justify-center min-h-[60vh] text-center">
                <div class="border-2 border-dashed border-[var(--border)] p-16 rounded-lg max-w-lg mx-auto">
                    <h2 class="text-4xl font-bold mb-4 text-[var(--text-muted)] opacity-40 font-oswald">АУДИОКНИГА</h2>
                    <p class="text-lg mb-8 text-[var(--text-muted)]">Этот раздел будет доступен позже.</p>
                    <div class="inline-block px-6 py-2 bg-[var(--border)] text-[var(--text-muted)] font-bold text-xs tracking-widest rounded-full">СКОРО</div>
                </div>
            </div>
        </section>

        <!-- ======================= Вкл 3: МАНГА ======================= -->
        <section id="section-manga" class="tab-section">
            <div class="book-container flex flex-col items-center justify-center min-h-[60vh] text-center">
                <div class="border-2 border-dashed border-[var(--border)] p-16 rounded-lg max-w-lg mx-auto">
                    <h2 class="text-4xl font-bold mb-4 text-[var(--text-muted)] opacity-40 font-oswald">МАНГА</h2>
                    <p class="text-lg mb-8 text-[var(--text-muted)]">Визуальная адаптация в разработке.</p>
                    <div class="inline-block px-6 py-2 bg-[var(--border)] text-[var(--text-muted)] font-bold text-xs tracking-widest rounded-full">СКОРО</div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- ЛОГИКА ТАБОВ ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('section-' + tabId).classList.add('active-section');
            
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active-tab'));
            const btn = document.getElementById('tab-' + tabId);
            if(btn) btn.classList.add('active-tab');

            const controls = document.getElementById('controls-read');
            const chapterSelector = document.getElementById('chapter-selector-container');
            
            if (tabId === 'read') {
                if(controls) controls.style.display = 'flex';
                if(chapterSelector) chapterSelector.style.display = 'block';
            } else {
                if(controls) controls.style.display = 'none';
                if(chapterSelector) chapterSelector.style.display = 'none';
            }
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // --- ЛОГИКА ЧТЕНИЯ ---
        let currentChapter = 0;
        let totalChapters = 0;

        function buildDropdown() {
            const dropdown = document.getElementById('chapter-dropdown');
            if (!dropdown) return;
            dropdown.innerHTML = '';
            const chapters = document.querySelectorAll('#chapters-container .chapter-content');
            chapters.forEach((chapter, idx) => {
                const titleEl = chapter.querySelector('.chapter-title');
                const numberText = idx === 0 ? 'Вступление' : `Глава ${idx}`;
                const option = document.createElement('option');
                option.value = idx;
                option.textContent = titleEl ? `${numberText}: ${titleEl.textContent}` : numberText;
                dropdown.appendChild(option);
            });
            dropdown.value = currentChapter;
        }

        function updateChapterUI() {
            document.querySelectorAll('#chapters-container .chapter-content').forEach(el => el.classList.remove('active-chapter'));
            const active = document.querySelector(`#chapters-container .chapter-content[id$='-${currentChapter}']`);
            if (active) active.classList.add('active-chapter');
            
            const prevBtn = document.getElementById('btn-prev');
            const nextBtn = document.getElementById('btn-next');
            if (prevBtn) prevBtn.disabled = currentChapter === 0;
            if (nextBtn) {
                nextBtn.disabled = totalChapters === 0;
                nextBtn.innerText = currentChapter === totalChapters ? "В НАЧАЛО" : "ВПЕРЕД →";
            }

            const indicator = document.getElementById('chapter-indicator');
            if (indicator) indicator.innerText = currentChapter === 0 ? "ВСТУПЛЕНИЕ" : `ГЛАВА ${currentChapter}`;

            const dropdown = document.getElementById('chapter-dropdown');
            if(dropdown) dropdown.value = currentChapter;

            const progressBar = document.getElementById('progress-bar');
            const progress = totalChapters === 0 ? 0 : (currentChapter / totalChapters) * 100;
            if (progressBar) progressBar.style.width = `${progress}%`;

            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function nextChapter() {
            if (currentChapter < totalChapters) {
                currentChapter++;
            } else {
                currentChapter = 0;
            }
            updateChapterUI();
        }

        function prevChapter() {
            if (currentChapter > 0) {
                currentChapter--;
                updateChapterUI();
            }
        }

        function goToChapter(index) {
            currentChapter = parseInt(index, 10) || 0;
            switchTab('read');
            updateChapterUI();
        }

        async function loadChapters() {
            const container = document.getElementById('chapters-container');
            if (!container) return;
            container.innerHTML = '<div class="text-center text-[var(--text-muted)] italic">Загрузка глав...</div>';
            try {
                const response = await fetch('chapters.html');
                if (!response.ok) throw new Error('Не удалось загрузить главы');
                const html = await response.text();
                container.innerHTML = html;
                const chapters = Array.from(container.querySelectorAll('.chapter-content'));
                totalChapters = Math.max(...chapters.map(el => {
                    const id = el.id?.split('-')[1];
                    const num = Number(id);
                    return Number.isFinite(num) ? num : 0;
                }));
                // Привести классы к новой схеме
                chapters.forEach(ch => ch.classList.remove('active'));
                currentChapter = 0;
                buildDropdown();
                updateChapterUI();
            } catch (err) {
                container.innerHTML = `<div class="text-center text-red-700">${err.message}</div>`;
            }
        }

        // --- ТЕМНАЯ ТЕМА ---
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const sun = document.getElementById('icon-sun');
            const moon = document.getElementById('icon-moon');
            const isDark = document.body.classList.contains('dark-mode');
            if (sun && moon) {
                if (isDark) {
                    sun.classList.remove('hidden');
                    moon.classList.add('hidden');
                } else {
                    sun.classList.add('hidden');
                    moon.classList.remove('hidden');
                }
            }
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // --- ИНИЦИАЛИЗАЦИЯ ---
        (function init() {
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                const sun = document.getElementById('icon-sun');
                const moon = document.getElementById('icon-moon');
                if (sun && moon) { sun.classList.remove('hidden'); moon.classList.add('hidden'); }
            }
            switchTab('read');
            loadChapters();
        })();
    </script>
</body>
</html>
